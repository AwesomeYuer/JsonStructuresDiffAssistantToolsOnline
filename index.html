<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="Generator" content="EditPlus速,Microshaoft">
    <meta name="Author" content="EditPlus速,Microshaoft">
    <meta name="Keywords" content="EditPlus速,Microshaoft">
    <meta name="Description" content="EditPlus速,Microshaoft">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <title>MS SQL Code Diff Verioning</title>

    <script src="libs/knockout/knockout-3.5.1.debug.js" type="text/javascript"></script>
    <script src="libs/jquery/jquery-3.5.1.js" type="text/javascript"></script>

    <link rel="stylesheet" href="libs/jquery-ui/jquery-ui-1.12.1.css">
    <script src="libs/jquery-ui/jquery-ui-1.12.1.js"></script>

    <link href="libs/driver.js/driver.min.css" rel="stylesheet" />
    <script src="libs/driver.js/driver.min.js"></script>

    <script src="libs/splitjs/split.js"></script>

    <script src="libs/monaco-editor/min/vs/loader.js"></script>

    <!-- <script src="libs/jsonify/parse.js"></script>
    <script src="libs/jsonify/stringify.js"></script> -->

    <style type="text/css">
        body {
            font-size: 12px;
            font-family: Sans-Serif;
        }

        h2 {
            margin: 0.5em 0 0.1em;
            text-align: center;
        }

        .top {
            text-align: center;
        }

        .textInput {
            display: block;
            width: 49%;
            float: left;
        }

        textarea {
            width: 100%;
            height: 300px;
        }

        label:hover {
            text-decoration: underline;
            cursor: pointer;
        }

        .spacer {
            margin-left: 10px;
        }

        .viewType {
            font-size: 16px;
            clear: both;
            text-align: center;
            padding: 1em;
        }

        #diffoutput {
            width: 100%;
        }
    </style>
    <!--split.js css-->
    <style>

        html,
        body {
            height: 100%;
        }

        body {
            padding: 8px;
            background-color: #F6F6F6;
            box-sizing: border-box;
        }

        .split {
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .content {
            border: 1px solid #C0C0C0;
            box-shadow: inset 0 1px 2px #e4e4e4;
            background-color: #fff;
        }

        .gutter {
            background-color: transparent;
            background-repeat: no-repeat;
            background-position: 50%;
        }

        .gutter.gutter-horizontal {
            cursor: col-resize;
            /* background-image: url('../grips/vertical.png');*/
        }

        .gutter.gutter-vertical {
            cursor: row-resize;
            /*background-image: url('../grips/horizontal.png');*/
        }

        .split.split-horizontal,
        .gutter.gutter-horizontal {
            height: 100%;
            float: left;
        }
    </style>

    <style type="text/css">
        #loading {
            position: fixed;
            top: 0px;
            right: 0px;
            bottom: 0px;
            filter: alpha(opacity=60);
            background-color: #777;
            z-index: 1002;
            left: 0px;
            display: none;
            opacity: 0.5;
            /*-moz-opacity: 0.5;*/
            padding-top: 100px;
            color: #000000
        }
    </style>
    <link href="styles/taiji.css" rel="stylesheet" />
    <link href="styles/fan.css" rel="stylesheet" />
    <link href="styles/text-magic.css" rel="stylesheet" />

    <script type="text/javascript">

        //var stringify = require('json-stable-stringify')



        function reStringify(x) {
            var a = JSON.parse(x);
            var reStringifyJson = JSON.stringify(a, function (k, v) {
            if (typeof v == 'string') {
                console.log('%s : %s', k, JSON.stringify(v));
                //if (k.indexOf("F") >= 0) {
                    return '********';
                //}
                keys = '';
            } else if (typeof v == 'number') {
                return 0;
                keys = '';
            } else if (typeof v == 'boolean') {
                return true;
                keys = '';
            } else if (typeof v == 'undeclaredVariable') {
                return undefined;
                keys = '';
            }
            return v;
            }, 2);
            return reStringifyJson;

        }

        $(document).keyup(function (e) {
            if (e.key === "Escape") { // escape key maps to keycode `27`
                // <DO YOUR WORK HERE>
                $('#loading').hide();
            }
        });

        window.jwtToken = "";
        $(document).ready(function () {
            $('#loading').hide();
        });
        $(function () {
            $('#datepicker1').datepicker();
        });
        var baseUrl = "http://localhost:5000";
        baseUrl = "";
        function GetObjectsTexts() {
            
            //debugger;
            
            $('#loading').fadeIn();

            //data = data["Outputs"]["ResultSets"][0]["Rows"];

            var ss = reStringify(topLeftEditor.getValue());
            var x1 = {
                TextBody: ss
            };

            ss = reStringify(topRightEditor.getValue());
            var x2;
            var x2 = {
                    TextBody: ss
            };
            
            diffUsingJS(parseInt(vm.SelectedDiffViewType()),
                x1, x2
            );
        }
    </script>
</head>
<body>
    <div id="loading" align="center">

        <font size="10" color="red"><strong>Loading ...</strong></font>
        <br>
        <font size="10" color="red"><strong>press Esc for cancel waiting</strong></font>

        <!--
            <div class="fan-wrapper">
                <div class="fan"></div>
            </div>
        -->
        <div class="text-magic" data-word="Loading...">
            <div class="white"></div>
        </div>

        <div class="box-taiji">
        </div>
    </div>
        <div>
            <a href="#" class="btn__run-demo">Show Demo</a>
        </div>
        <div>

            
        </div>
        <br />            
        <div id="up" class="split" style="border: 1px solid black">
            <div id="left" class="split content split-horizontal" width="50%">
            </div>
            <div id="right" class="split content split-horizontal" width="50%">
            </div>
        </div>
    
    <div id="down" class="split content">
        <div class="viewType">
            Diff View Type:
            <br />
            <input type="radio" id="diffViewType0" value="0" data-bind="checked:SelectedDiffViewType" />
            <label for="diffViewType0" onclick="GetObjectsTexts();">Side</label>
            <input type="radio" id="diffViewType1" value="1" data-bind="checked:SelectedDiffViewType" />
            <label for="diffViewType1" onclick="GetObjectsTexts();">Inline</label>
        </div>
        <div id="diffoutput">
            <div id="container" style="width:100%;height:400px;border:1px solid grey"></div>
        </div>
    </div>
    <script>
        Split(['#up', '#down'], {
            gutterSize: 10,
            cursor: 'row-resize',
            direction: 'vertical',
            sizes: [20, 80]
        });
        Split(['#left', '#right'], {
            sizes: [50, 50],
            gutterSize: 10,
            cursor: 'col-resize',
        });

        

        require.config({ paths: { 'vs': 'libs/monaco-editor/min/vs' } });
        var topLeftEditor;
        require(['vs/editor/editor.main'], function () {
        // "javascript"
        //topLeftEditor = monaco.editor.create(document.getElementById('left'));
        topLeftEditor = monaco.editor.create(document.getElementById('left'), {
            value: [
                    '{'                 ,
                        '   "a":"11111",'   ,
                        '   "b":"222",'      ,
                        '   "c":false'      ,
                    '}'
                    ].join('\n')        ,
                    language: 'json'     ,
                    automaticLayout: true
            });
        });
        var topRightEditor;            
        require(['vs/editor/editor.main'], function () {
            // "javascript"
            topRightEditor = monaco.editor.create(document.getElementById('right'), {
            value: [
                    '{'                 ,
                        '   "b": 1000,'   ,
                        '   "a":"222"'      ,
                    '}'
                    ].join('\n')        ,
                    language: 'json'     ,
                    automaticLayout: true
            });
        });




        var diffEditor;
        require(['vs/editor/editor.main'], function () {
            diffEditor = monaco.editor.createDiffEditor(document.getElementById('container'),{
                        language: 'json'     ,
                        automaticLayout: true

            });
        });
        var viewModel = function (data) {
            var self = this;
            this.SelectedDiffViewType = ko.observable("0");

        };

            
        var vm = new viewModel([]);
        ko.applyBindings(vm);
        function diffUsingJS(viewType, baseObject, newObject) {
            var originalTxt = baseObject.TextBody;
            var modifiedTxt = newObject.TextBody;
            diffEditor.updateOptions({
                renderSideBySide: !viewType,
                readOnly: true
            });
            diffEditor.setModel({
                original: monaco.editor.createModel(originalTxt, 'sql'),
                modified: monaco.editor.createModel(modifiedTxt, 'sql')
            });
            $('#loading').fadeOut();
        }

       
    </script>
</body>
</html>